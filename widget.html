<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elev8Trades — Local Visibility Audit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; line-height: 1.45; }
    .form { max-width: 960px; margin: 0 auto; }
    .row { margin: 12px 0; display: grid; gap: 8px; }
    .controls { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    input, select { padding: 8px 10px; border-radius: 8px; border: 1px solid var(--line,#ccc); min-width: 220px; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; background:#111827; color:white; cursor:pointer; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 14px; margin: 14px 0; }
    .small { font-size: 12px; opacity: .8; }
    .banner { padding: 10px 12px; border-radius: 10px; background:#ecfeff; color:#0e7490; margin: 10px 0; }
    .banner.error { background:#fee2e2; color:#991b1b; }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .bar { height: 10px; background:#e5e7eb; border-radius: 10px; overflow: hidden; }
    .bar > div { height: 100%; background:#31d01b; width: 0%; transition: width .3s ease; }
    .nowrap { white-space: nowrap; }
    .mapWrap { height: 280px; border-radius: 10px; overflow: hidden; border: 1px solid #e5e7eb; }
    iframe { width: 100%; height: 100%; border: 0; }
    .candidates .candidate { padding: 8px 10px; border:1px solid #e5e7eb; border-radius: 10px; margin: 6px 0; cursor: pointer; }
    .candidates .candidate:hover { background:rgba(49,208,27,0.08); }
    .tableWrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #eee; text-align: left; }
    th[role="button"] { cursor: pointer; user-select: none; }
    #loading { display: none; }
    #mapHint { font-size: 12px; opacity: .75; }
    #statusPill { display:inline-block; padding: 4px 8px; border-radius: 20px; background:#f3f4f6; }
    #ceilingLine { display:none; font-size: 12px; opacity: .9; }
    #playbookBackdrop { display:none; position:fixed; inset:0; background:rgba(0,0,0,.4); align-items:center; justify-content:center; }
    #playbookModal { background:#fff; color:#111; padding:16px; border-radius:12px; max-width:720px; width:92%; }
  </style>
</head>
<body>
  <div class="form">
    <h1>Elev8Trades — Local Visibility Audit</h1>

    <div id="bannerHost"></div>

    <div class="card">
      <div class="row controls">
        <input id="bName" placeholder="Business name (optional for SITE_ONLY)" aria-label="Business Name" />
        <input id="webUrl" placeholder="Website URL (www optional)" aria-label="Website URL" />
        <select id="tradeSelect" aria-label="Trade">
          <option>— Select —</option>
          <option value="roofing">Roofing</option>
          <option value="plumbing">Plumbing</option>
          <option value="electrical">Electrical</option>
          <option value="landscaping">Landscaping</option>
          <option value="hvac">HVAC</option>
          <option value="masonry">Masonry</option>
        </select>
        <input id="area" placeholder="Service area (city, state or county)" aria-label="Service Area" />
      </div>
      <div class="row controls">
        <label><input type="checkbox" id="fast" /> Fast (skip deep HTML)</label>
        <label><input type="checkbox" id="siteOnly" /> Website-only (no GBP)</label>
        <label><input type="checkbox" id="noCache" /> No-cache</label>
        <button id="btnAnalyze">Analyze</button>
        <button id="btnCompetitors">Top Competitors</button>
        <button id="btnPlaybook" type="button">Playbook</button>
        <span id="loading" class="small">Loading…</span>
      </div>
    </div>

    <div class="card">
      <div class="grid2">
        <div>
          <h3>Overall: <span id="finalScore">0</span>/100</h3>
          <div id="statusPill" class="small">—</div>
          <p id="rationale" class="small"></p>
          <p id="ceilingLine" class="small">Ceiling in effect — fix noted gaps to unlock higher scores.</p>

          <h4>GBP Signals</h4>
          <div class="row">
            <div>Rating</div><div class="bar"><div id="bar-rating"></div></div>
            <div>Volume</div><div class="bar"><div id="bar-volume"></div></div>
            <div>Category Match</div><div class="bar"><div id="bar-category"></div></div>
            <div>Photos</div><div class="bar"><div id="bar-photos"></div></div>
            <div>Hours</div><div class="bar"><div id="bar-hours"></div></div>
          </div>
        </div>
        <div>
          <h4>Map Preview</h4>
          <div class="mapWrap">
            <iframe id="mapFrame" sandbox="allow-scripts allow-same-origin" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
          </div>
          <div id="mapHint" class="small">Add/select a GBP to preview location here.</div>
        </div>
      </div>
    </div>

    <div id="candidatesCard" class="card" style="display:none;">
      <h3>Select Your Business</h3>
      <div id="candidates" class="candidates"></div>
    </div>

    <div id="competitorsCard" class="card" style="display:none;">
      <h3>Top Competitors</h3>
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th data-k="name" role="button" tabindex="0">Name</th>
              <th data-k="rating" role="button" tabindex="0">Rating</th>
              <th data-k="reviews" role="button" tabindex="0">Reviews</th>
              <th data-k="types" role="button" tabindex="0">Primary Category</th>
              <th data-k="address" role="button" tabindex="0">Address</th>
              <th data-k="openNow" role="button" tabindex="0">Status</th>
              <th data-k="photosCount" role="button" tabindex="0">Photos</th>
              <th>Links</th>
            </tr>
          </thead>
          <tbody id="compTbody"></tbody>
        </table>
      </div>
      <div id="compMeta" class="small"></div>
    </div>
  </div>

  <!-- Playbook Modal -->
  <div id="playbookBackdrop">
    <div id="playbookModal">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3 id="pb-title">Local Services Playbook</h3>
        <div>
          <button id="pb-close-1">Close</button>
        </div>
      </div>
      <ol class="small">
        <li>Claim/verify GBP. Add photos (aim for 20+), hours, services, and categories.</li>
        <li>Earn reviews consistently (target 5–10/mo). Reply to all.</li>
        <li>Fix NAP citations; ensure site shows phone, address, and service areas.</li>
        <li>Add location + service pages with unique content and clear CTAs.</li>
        <li>Track calls and form fills; iterate monthly.</li>
      </ol>
      <div style="text-align:right;">
        <button id="pb-close-2">Done</button>
      </div>
    </div>
  </div>

  <script src="widget.js"></script>
</body>
</html>
